# {プロジェクト名} - Claude Rules

## 📋 プロジェクト概要

このプロジェクトは『{書籍名またはチュートリアル名}』の学習と実践を目的としています。
参考リポジトリを基に、AI駆動開発でゼロから実装していきます。

> **プロジェクト作成時にカスタマイズ**:
> - `{プロジェクト名}`: このプロジェクトの名前
> - `{書籍名またはチュートリアル名}`: 学習対象の教材名
> - `{参考リポジトリURL}`: 参考にするGitHubリポジトリのURL

---

## 🎯 プロジェクトの目的

1. {教材}の内容を理解する
2. 参考コードを分析し、設計思想を学ぶ
3. 学んだ内容をゼロから実装して実践的スキルを習得する
4. 学習過程を記録し、知識を体系化する

---

## 📁 ディレクトリ構造とルール

### ディレクトリの役割

```
.
├── 01_reference/           # 参考リポジトリ（読み取り専用）
├── 02_templates/           # テンプレートファイル
├── 03_my_implementations/  # 自分で実装するコード（書き込み可）
├── 04_notes/               # 学習ノート・メモ（書き込み可）
├── 05_progress/            # 進捗管理（書き込み可）
└── 06_docs/                # ドキュメント
```

### 重要なルール

1. **`01_reference/` は読み取り専用**
   - 参考リポジトリのコードは変更しない
   - 分析や理解のためにのみ参照する
   - 必要に応じてコピーして `03_my_implementations/` で改変

2. **`03_my_implementations/` に実装する**
   - ゼロから実装したコードはここに配置
   - トピックごとにサブディレクトリを作成
   - **ディレクトリ命名規則**: `{NN}_{topic_name}/` (例: `01_setup/`, `02_basic_api/`)
   - **連番の接頭辞**: フロー順に理解できるように連番（01, 02, 03...）を接頭辞として付ける
   - **重要**: Pythonファイル名には連番を付けない（importエラーになるため）
     - ✅ ディレクトリ: `01_setup/`, `02_basic_api/`
     - ❌ Pythonファイル: `01_data_loader.py`（数字で始まるとimportできない）
     - ✅ Pythonファイル: `data_loader.py`, `model.py`, `trainer.py`

3. **`04_notes/` に学習メモを記録**
   - トピックごとの理解をまとめる
   - アーキテクチャ図や設計メモを保存
   - **命名規則**: `{NN}_{topic_name}.md`（連番接頭辞を必ず付ける）
   - **連番の目的**: フロー順に整理し、学習の流れを明確にする

4. **`05_progress/` で進捗を管理**
   - `learning_log.md` は**進捗の把握のみに使用**
     - どこまで完了したか（チェックリスト）
     - 次にどこから始めるか（次のタスク）
   - **詳細な内容は各ディレクトリのREADMEで確認する**
     - 実装の詳細、技術スタック、学習内容は各トピックのREADME.mdに記載
     - learning_log.mdには詳細を書かず、完了日とステータスのみ記録

---

## 💻 コーディング規約

### Python

- **バージョン**: Python 3.13以上（最新の安定版を使用）
- **パッケージマネージャー**: uv（高速・モダンなパッケージマネージャー）
- **スタイル**: PEP 8に準拠
- **型ヒント**: 可能な限り使用する
- **docstring**: 重要な関数・クラスには必須
- **コメントとdocstringの言語**: **必ず日本語で記載すること**
  - ✅ モジュールdocstring: 日本語
  - ✅ 関数/クラスdocstring: 日本語
  - ✅ インラインコメント: 日本語
  - ❌ 英語のコメントは使用しない
- **命名規則**:
  - 関数/変数: `snake_case`
  - クラス: `PascalCase`
  - 定数: `UPPER_CASE`

#### uvの使い方

```bash
# プロジェクトの初期化
uv init

# 依存関係のインストール
uv pip install <package>

# 仮想環境の作成と有効化
uv venv
source .venv/bin/activate  # macOS/Linux

# pyproject.tomlから依存関係をインストール
uv pip install -r pyproject.toml

# 依存関係のロック
uv pip freeze > requirements.txt
```

### Docker

- **ベースイメージ**: 公式イメージを使用
- **マルチステージビルド**: 可能な限り使用してイメージサイズを削減
- **環境変数**: センシティブな情報は`.env`ファイルで管理（gitignore必須）
- **.dockerignore**: 不要なファイルをコンテナに含めない

### ファイル構成

各実装には以下を含める：

#### 必須ファイル
- `SPECIFICATION.md` - **仕様書**（要件、アーキテクチャ、API設計）
- `README.md` - 実装の説明、セットアップ手順、実行方法
- `pyproject.toml` - プロジェクトメタデータと依存関係（uvで管理）
- `tests/` - テストコード（テスト駆動開発）
  - `test_unit.py` - ユニットテスト
  - `test_integration.py` - 統合テスト
  - `test_e2e.py` - E2Eテスト（必要に応じて）

#### 自動生成ファイル
- `uv.lock` - 依存関係のロックファイル（uvが自動生成）

#### オプションファイル
- `.python-version` - Pythonバージョンの指定
- `docker-compose.yml` - Docker環境
- `Makefile` - よく使うコマンドのショートカット
- `.env.example` - 環境変数のサンプル

---

## 📝 開発プロセス（仕様駆動 + テスト駆動）

このプロジェクトでは、実践に近い形で**仕様駆動開発（SDD）**と**テスト駆動開発（TDD）**を組み合わせて進めます。

### 開発フロー（全7フェーズ）

#### 1. **理解フェーズ** 📖
   - `reference/` の該当コードを読む
   - アーキテクチャ、データフロー、依存関係を理解する
   - ビジネス要件と技術的課題を把握する
   - `notes/` にメモを作成

#### 2. **仕様策定フェーズ** 📋 ← **仕様駆動開発**
   - `SPECIFICATION.md` を作成する
   - 以下を明確に定義：
     - **要件定義**: 機能要件と非機能要件
     - **アーキテクチャ設計**: システム構成、コンポーネント設計
     - **API仕様**: エンドポイント、入出力形式、エラーレスポンス
     - **データモデル**: データ構造、スキーマ
     - **成功基準**: 何を持って完成とするか
   - 仕様をClaude Codeとレビュー・議論する

#### 3. **テスト設計フェーズ** 🧪 ← **テスト駆動開発（Red）**
   - 仕様に基づいてテストケースを作成
   - テストの種類：
     - **ユニットテスト**: 個々の関数・クラスのテスト
     - **統合テスト**: コンポーネント間の連携テスト
     - **E2Eテスト**: システム全体の動作テスト
   - まず失敗するテストを書く（Red）
   - `pytest` で実行してテストが失敗することを確認

#### 4. **実装フェーズ** 💻 ← **テスト駆動開発（Green）**
   - `03_my_implementations/` にゼロから実装
   - テストを通すための最小限の実装から始める
   - 段階的に機能を拡張
   - 各ステップでテストを実行してGreenにする

#### 5. **リファクタリングフェーズ** ♻️ ← **テスト駆動開発（Refactor）**
   - テストが通った状態でコードを改善
   - 以下を意識：
     - コードの可読性向上
     - 重複の削除（DRY原則）
     - 適切な抽象化
     - パフォーマンス最適化
   - リファクタリング後もテストがGreenであることを確認

#### 6. **検証フェーズ** ✅
   - 実装したコードを実際に動かして確認
   - ログやメトリクスを確認
   - 仕様書の成功基準を満たしているか検証
   - エッジケースやエラーハンドリングの確認

#### 7. **振り返りフェーズ** 📊
   - **ドキュメント更新（必須）**
     1. トピックディレクトリの `README.md` を更新（詳細な学習内容を記載）
     2. プロジェクトルートの `README.md` を更新（全体の進捗を反映）
     3. `progress/learning_log.md` に完了日とステータスを記録（詳細は書かない）
   - **学習内容の整理**
     - 学んだこと、疑問点、改善点をトピックのREADMEにまとめる
     - 仕様と実装のギャップを分析
   - **コードレビュー**（自己レビュー）を実施
   - **Git操作**
     - 変更をコミット
     - プッシュ（Claude Codeは実行前に必ず確認を取る）

### TDDサイクル（Red-Green-Refactor）

```
┌─────────────────────────────────────┐
│  1. 仕様を書く（SPECIFICATION.md） │
└──────────────┬──────────────────────┘
               ↓
┌──────────────────────────────────────┐
│  2. テストを書く（失敗するテスト）  │ ← Red
└──────────────┬───────────────────────┘
               ↓
┌──────────────────────────────────┐
│  3. 実装する（テストを通す）    │ ← Green
└──────────────┬───────────────────┘
               ↓
┌──────────────────────────────┐
│  4. リファクタリングする    │ ← Refactor
└──────────────┬───────────────┘
               ↓
      テストが通っているか？
               ↓
          [次の機能へ]
```

---

## 🔧 実装時の注意事項

### セキュリティ

- **機密情報**: API キー、パスワード等は環境変数で管理
- **`.gitignore`**: `.env`, `*.pem`, `*.key` 等を必ず追加
- **依存関係**: セキュリティ脆弱性のあるパッケージを避ける
- **入力検証**: 外部からの入力は必ず検証・サニタイズ

### パフォーマンス

- **リソース管理**: メモリリーク、ファイルディスクリプタのクローズ漏れに注意
- **非同期処理**: I/Oバウンドな処理は非同期化を検討
- **バッチサイズ**: メモリを考慮した適切なバッチサイズを設定
- **キャッシュ**: 計算コストの高い処理は適切にキャッシュ

### データファイルの管理（重要）⚠️

**大容量データはGitにプッシュしない**

GitHubの制限（100MB）を超えるファイルはプッシュできません。以下のルールを厳守してください。

#### 禁止事項

❌ **以下のファイルをGitにコミット・プッシュしない**:
- データセットの圧縮ファイル（*.tar.gz, *.zip, *.tar, *.7z, *.rar）
- 大容量データセット
- 展開済みのデータセットディレクトリ

#### 推奨方法

✅ **データセットの正しい管理方法**:

1. **ダウンロードスクリプトを作成**
2. **README.mdに記載**
3. **.gitignoreに追加** （すでに設定済み）

---

## 🚀 開発ワークフロー

### 新しいトピックを実装する場合（仕様駆動 + TDD）

#### Step 1: プロジェクトセットアップ

```bash
# 1. ディレクトリを作成
mkdir -p 03_my_implementations/{NN}_{topic_name}
cd 03_my_implementations/{NN}_{topic_name}

# 2. テンプレートからpyproject.tomlをコピー
cp ../../02_templates/pyproject.toml.template pyproject.toml

# 3. Pythonバージョンを指定
echo "3.13" > .python-version

# 4. 仮想環境の作成
uv venv

# 5. 仮想環境の有効化
source .venv/bin/activate  # macOS/Linux

# 6. 開発ツールのインストール
uv pip install pytest pytest-cov black ruff mypy

# 7. ディレクトリ構造を作成
mkdir -p tests src/{topic_name}
touch src/{topic_name}/__init__.py
touch tests/__init__.py
```

#### Step 2-7: 開発フロー

詳細は上記の「開発プロセス（仕様駆動 + テスト駆動）」を参照してください。

---

## 📊 進捗管理

### progress/learning_log.md の役割

**重要**: `progress/learning_log.md` は**進捗把握専用**です。詳細な内容は書きません。

**記載内容**:
- ✅ どこまで完了したか（チェックリスト）
- ✅ 次にどこから始めるか（次のタスク）
- ✅ 完了日のみ（例: `2025-11-05`）
- ❌ 学習内容の詳細（各READMEで確認）
- ❌ 実装の詳細（トピックのREADMEで確認）
- ❌ 技術スタック（トピックのREADMEで確認）

### ドキュメント更新フロー（必須）

**各チュートリアル完了後は必ず以下の順序でドキュメントを更新すること**:

1. **トピックのREADME.md**
   - 実装の詳細、技術スタック、学習内容を詳しく記載
   - 他の人が見てもわかるように丁寧に書く

2. **プロジェクトルートのREADME.md**
   - 全体の完了トピック数を更新
   - 完了したトピックのリストを更新

3. **progress/learning_log.md**
   - 完了日とステータスのみ記録
   - 詳細は書かない

---

## 🤝 Claude Codeとの協働ルール

### Claude Code に期待すること

1. **コード分析**: 参考コードの詳細な説明
2. **設計支援**: アーキテクチャの提案と議論
3. **実装サポート**: ゼロからのコーディング支援
4. **レビュー**: 実装したコードの改善提案
5. **トラブルシューティング**: エラーの解決支援
6. **ドキュメント作成**: README等の作成補助

### Claude Code が守るべきこと

1. **仕様駆動**: まず仕様を明確にし、それに基づいて開発を進める
2. **テスト駆動**: テストを先に書き、Red→Green→Refactorのサイクルを守る
3. **段階的実装**: 一度に全てを実装せず、小さなステップで進める
4. **説明**: コードだけでなく、なぜそう実装するのか説明する
5. **選択肢の提示**: 複数のアプローチがある場合は選択肢を示す
6. **学習重視**: 単にコードを書くだけでなく、理解を深める支援をする
7. **ベストプラクティス**: 本番環境を想定した品質のコードを書く
8. **実践的**: エラーハンドリング、ログ、モニタリングを含める
9. **Git操作の確認**: `git push` は実行前に必ずユーザーの確認を取る
10. **ドキュメント更新**: 各チュートリアル完了後、**必ず3段階のドキュメント更新**を実施する
    - トピックのREADME.md → プロジェクトのREADME.md → learning_log.md
11. **命名規則**:
    - トピックディレクトリには連番を接頭辞として付ける（01_, 02_, 03_...）
    - Pythonファイル名には連番を付けない（importエラーを回避）

---

## 🔒 個人情報とセキュリティルール

### 個人情報の取り扱い

このプロジェクトは公開リポジトリとして運用されるため、個人情報の管理を徹底してください。

#### 禁止事項

以下の個人情報をコード、ドキュメント、コミットメッセージに含めないでください：

1. **実名**
2. **連絡先情報**（メールアドレス、電話番号、住所）
3. **システム固有情報**（ローカルマシンのユーザー名、ホスト名）

#### 推奨事項

**GitHubユーザー名を使用**:
- ドキュメントの作者名: GitHubユーザー名
- Gitコミット設定:
  ```bash
  git config --global user.name "your-github-username"
  git config --global user.email "your-github-username@users.noreply.github.com"
  ```

### 機密情報の取り扱い

#### 管理が必要な情報

1. **APIキー・トークン**
2. **環境変数**（データベース接続情報、サービスの認証情報）
3. **秘密鍵**（SSH秘密鍵、暗号化キー、証明書）

#### 安全な管理方法

**環境変数ファイル**:
```bash
# .env ファイルを使用（gitignore必須）
API_KEY=your_key_here
DATABASE_URL=postgresql://user:pass@localhost/db
```

**サンプルファイルの提供**:
```bash
# .env.example をリポジトリにコミット
API_KEY=your_key_here
DATABASE_URL=postgresql://localhost/db
```

**.gitignoreの設定**:
```gitignore
# Secrets
*.pem
*.key
credentials.json
secrets.yaml

# MCP Configuration (contains API tokens)
.mcp.json
.claude/settings.local.json

# Environment variables
.env
.env.local
.env.*.local
```

---

## 🔄 このファイルの更新

このルールファイルは学習の進捗に応じて更新してください：
- 新しいベストプラクティスを発見したら追加
- 不要なルールは削除
- プロジェクトの方向性が変わったら反映

最終更新: {YYYY-MM-DD}
